@namespace GameBox.PlagueDoctor
@using GameBox.PlagueDoctor.Data

<div class="plague-doctor-game">
    <div class="game-header">
        <div class="score-display">
            <span>Score: @PlagueService.State.Score</span>
            <span>Level: @PlagueService.State.Level</span>
            <span>Viruses: @PlagueService.State.VirusesRemaining</span>
        </div>
    </div>

    <div class="game-area">
        <div class="next-pill-preview">
            <h4>Next</h4>
            @if (PlagueService.NextPill != null)
            {
                <div class="preview-pill">
                    <div class="pill-half @GetColorClass(PlagueService.NextPill.Color1)"></div>
                    <div class="pill-half @GetColorClass(PlagueService.NextPill.Color2)"></div>
                </div>
            }
        </div>

        <div class="bottle-container" tabindex="0" @onkeydown="HandleKeyDown" @ref="gameContainer">
            <div class="bottle">
                @for (int row = 0; row < BoardGrid.Rows; row++)
                {
                    @for (int col = 0; col < BoardGrid.Columns; col++)
                    {
                        var r = row;
                        var c = col;
                        var cell = PlagueService.Board.GetCell(r, c);
                        var isCurrentPill = IsCurrentPillPosition(r, c);

                        <div class="cell @GetCellClasses(cell, r, c, isCurrentPill)">
                            @if (cell.IsVirus)
                            {
                                <span class="virus-face">☣</span>
                            }
                        </div>
                    }
                }
            </div>
        </div>
    </div>

    <div class="game-controls">
        @if (PlagueService.State.Status == GameStatus.NotStarted)
        {
            <button class="game-btn" @onclick="StartGame">Start Game</button>
        }
        else if (PlagueService.State.Status == GameStatus.GameOver)
        {
            <div class="game-over">
                <h3>Game Over!</h3>
                <p>Final Score: @PlagueService.State.Score</p>
                <button class="game-btn" @onclick="StartGame">Play Again</button>
            </div>
        }
        else if (PlagueService.State.Status == GameStatus.Victory)
        {
            <div class="victory">
                <h3>Level Complete!</h3>
                <button class="game-btn" @onclick="NextLevel">Next Level</button>
            </div>
        }
        else if (PlagueService.State.Status == GameStatus.Paused)
        {
            <button class="game-btn" @onclick="ResumeGame">Resume</button>
        }
        else
        {
            <button class="game-btn" @onclick="PauseGame">Pause</button>
        }
    </div>

    <div class="controls-help">
        <p>← → Move | ↓ Drop | Z/X Rotate | Space Hard Drop</p>
    </div>
</div>
